unit AddList;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtCtrls,
  Vcl.Mask, System.Actions, Vcl.ActnList, UObjects, UWorkers, UContractors;

type
  TAddListForm = class(TForm)
    pnlMain: TPanel;
    lblInput1: TLabel;
    edtInput1: TEdit;
    lblInput2: TLabel;
    edtInput2: TEdit;
    lblInput3: TLabel;
    edtInput3: TEdit;
    btnAddList: TButton;
    cbbSetCompany: TComboBox;
    cbbSetObject: TComboBox;
    lblInput4: TLabel;
    edtInput4: TEdit;
    procedure FormActivate(Sender: TObject);
    procedure btnAddListClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  AddListForm: TAddListForm;

implementation

{$R *.dfm}
uses Tender;

procedure TAddListForm.btnAddListClick(Sender: TObject);
var 
  st:string;
begin
  case TenderForm.mode of
    MObjList:
    begin
      try
        if ObjAdrOf(TenderForm.getObjHead, Trim(edtInput1.Text)) = nil then
        begin
          if ( (Trim(edtInput1.Text) <> '') and (Trim(edtInput2.Text) <> '') and (Trim(edtInput1.Text) <> '')) then
          begin
            TenderForm.addNewObj(Trim(edtInput1.Text), StrToInt(edtInput2.Text), StrToCurr(edtInput3.Text));
            Self.Close;
          end
          else
            ShowMessage('Поля не могут быть пустыми');
        end
        else
          ShowMessage('Такой объект уже существует');
      except on E: Exception do
        ShowMessage('Некорректный ввод')
      end;
    end;
    MContrList:
    begin
      if ContrAdrOf(TenderForm.getContHead, Trim(edtInput1.Text)) = nil then
      begin
        if ( (Trim(edtInput1.Text) <> '')) then
        begin
          TenderForm.addNewCompany(edtInput1.Text);
          Self.Close;
        end
        else
            ShowMessage('Поля не могут быть пустыми');
      end
      else
        ShowMessage('Компания уже зарегистрирована');
    end;
    MWorkList:
    begin
      try
        st := edtInput2.Text;
          //ShowMessage( TenderForm.getAdditionalTitle );
          if (TenderForm.getAdditionalTitle <> '' ) then
          begin
            st:=TenderForm.getAdditionalTitle;
          end;

        if WorkerAdrOf(tenderform.getContHead, Trim(edtInput1.Text), st) = nil  then
        begin
          if ( (Trim(cbbSetObject.Text) <> '') and (Trim(edtInput1.Text) <> '') and (Trim(edtInput4.Text) <> '') and (Trim(cbbSetObject.Text) <> '')) then
          begin
            TenderForm.addNewWorkers(edtInput1.Text, cbbSetObject.Text,st, StrToCurr(edtInput4.Text));
            Self.Close;
          end
          else
            ShowMessage('Поля не могут быть пустыми');
        end
        else
          ShowMessage('Такой сотрудник уже есть');
      except on E: Exception do
        ShowMessage('Некорректный ввод')
      end;
    end;
  end;
end;

procedure TAddListForm.FormActivate(Sender: TObject);
begin

    case TenderForm.mode of
      MObjList:
      begin
        lblInput1.Caption := 'Название объекта';
        edtInput1.Text := '';
        lblInput2.Visible := true;
        lblInput3.Visible := True;
        edtInput2.Visible := true;
        edtInput3.Visible := True;
         cbbSetCompany.Visible := false;
         cbbSetObject.Visible:=False;
        
        edtInput4.Visible := false;
        lblInput4.Visible := false;
        lblInput2.Caption := 'Минимальное кол-во рабочих';
        edtInput2.Text := '';
        lblInput3.Caption := 'Цента материалов';
        edtInput3.Text := '';
      end;
      MContrList:
      begin
        lblInput2.Visible := false;
        lblInput3.Visible := false;
        edtInput2.Visible := false;
        edtInput3.Visible := false;
        edtInput4.Visible := false;
        lblInput4.Visible := false;
        cbbSetCompany.Visible := false;
        cbbSetObject.Visible:=False;
        lblInput1.Caption := 'Название компании';
        edtInput1.Text := '';
      end;
      MWorkList:
      begin
        lblInput2.Visible := true;
        lblInput3.Visible := true;
        edtInput2.Visible := false;
        edtInput3.Visible := false;
        cbbSetCompany.Visible := True;
        cbbSetObject.Visible:=true;
        getCBBObjectsList(cbbSetObject, TenderForm.getObjHead);
        getCBBContrList(cbbSetCompany, TenderForm.getContHead);
        if (TenderForm.getAdditionalTitle <> '' ) then
        begin
          cbbSetCompany.Enabled := false;
        end;
        edtInput4.Visible := true;
        lblInput4.Visible := true;
        lblInput1.Caption := 'ФИО';
        lblInput2.Caption:= 'Компания';
        lblInput3.Caption:= 'Объект';
        edtInput1.Text := '';
        lblInput4.Caption:= 'Зарплата';
        edtInput4.Text := '';
      end;
    end;



  

end;

end.
